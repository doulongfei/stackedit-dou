# StackEdit 中文版 - 私有化打包部署指南

本文档介绍了如何将 StackEdit 中文版打包为单文件可执行程序，并进行私有化部署。

## 1. 简介

通过本指南，您可以将前端 Vue 项目和后端 Python Flask 服务打包成一个独立的可执行文件（Linux 下为二进制文件）。这样，您可以在目标服务器上直接运行该文件，而无需安装 Node.js、Python 环境或各种依赖库。

## 2. 环境要求（构建环境）

如果您需要自己进行打包，您的构建机器需要满足以下要求：

*   **操作系统**: Linux (推荐 Ubuntu/Debian)
*   **Node.js**: v16+ (推荐 v20)
*   **Python**: v3.10+
*   **依赖工具**: `pip`, `npm`

## 3. 一键打包

项目根目录下提供了自动化打包脚本 `build_release.sh`。

### 步骤：

1.  **安装 Python 依赖**（首次运行需执行）：
    ```bash
    pip install -r server/requirements.txt
    pip install pyinstaller
    ```

2.  **安装前端依赖**（首次运行需执行）：
    ```bash
    npm install
    ```

3.  **运行打包脚本**：
    ```bash
    chmod +x build_release.sh
    ./build_release.sh
    ```

脚本会自动执行以下操作：
1.  调用 `npm run build` 编译前端代码生成静态资源。
2.  调用 `PyInstaller` 将 Python 后端代码、编译后的前端资源、静态文件、配置文件打包成一个独立的可执行文件。

### 输出结果：

打包成功后，可执行文件将位于：
`dist/stackedit`

## 4. 部署运行

### 部署要求：

目标服务器**不需要**安装任何语言环境，只需确保操作系统与打包环境架构一致（如都是 Linux x86_64）。

### 运行方式：

1.  将 `dist/stackedit` 文件上传到服务器任意目录。
2.  赋予执行权限：
    ```bash
    chmod +x stackedit
    ```
3.  直接运行：
    ```bash
    ./stackedit
    ```

服务启动后，默认监听 `8080` 端口。您可以通过浏览器访问 `http://服务器IP:8080` 使用编辑器。

### 配置修改（可选）：

虽然程序内置了默认配置，但为了支持 OAuth 登录（Gitee/GitHub）等功能，建议在可执行文件同级目录下创建一个 `.env` 文件来覆盖默认配置。

**.env 文件示例：**

```ini
# 监听端口
LISTENING_PORT=8080
# 是否开启调试模式
DEBUG_FLAG=false

# OAuth 配置 (根据需要填写)
GITEE_CLIENT_ID=your_client_id
GITEE_CLIENT_SECRET=your_client_secret
GITHUB_CLIENT_ID=your_client_id
GITHUB_CLIENT_SECRET=your_client_secret
```

程序启动时会优先读取同级目录下的 `.env` 文件配置。

## 5. 常见问题

**Q: 运行报错 `ImportError` 或缺少模块？**
A: 请确保在打包前 `server/requirements.txt` 中的所有依赖都已正确安装。如果在运行可执行文件时报错，可能是 PyInstaller 没有正确识别隐式导入的模块，请反馈给开发者更新打包脚本中的 `--hidden-import` 参数。

**Q: 如何修改端口？**
A: 在同级目录创建 `.env` 文件，设置 `LISTENING_PORT=您的端口号`，然后重启程序。
